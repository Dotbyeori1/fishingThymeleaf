<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>해그린피싱</title>
  <script>
    // 헤더에서 토큰 정보를 가져와서 HTTP 요청 헤더에 추가하는 함수
    function getHeaders() {
      var headers = new Headers();
      headers.append('Content-Type', 'application/json');
      var token = localStorage.getItem('token');
      if (token) {
        headers.append('Authorization', 'Bearer ' + token);
      }
      return headers;
    }

    // 인증이 필요한 요청을 보내는 함수
    function authenticatedRequest() {
      var token = localStorage.getItem('token');
      if (token) {
        fetch('/auth', {
          method: 'GET',
          headers: getHeaders()
        }).then(function (response) {
          if (response.ok) {
            response.json().then(function (data) {
              localStorage.removeItem('token');
              var token = data.token;
              localStorage.setItem('token', token);
              window.location.href = "/main";
            });
          } else {
            response.json().then(function (data) {
              console.log(data.error);
              localStorage.removeItem('token');
              window.location.href = "/main";
            });
          }
        });
      } else {
        setTimeout(function () {
          window.location.href = "/main";
        }, 500);
      }
    }

    authenticatedRequest();
  </script>
</head>
<body>
</body>
</html>